# 목표
- 자바 소스 파일(.java)를 JVM으로 실행하는 과정 이해하기

# JVM이란
- 자바 가상 머신 (JVM, Java Virtual Machine)이란 자바 바이트 코드를 실행시키기 위한 가상의 기계라고 할 수 있다.
- 자바로 작성된 모든 프로그램은 자바 가상 머신에서만 실행될 수 있으므로, 자바 프로그램을 실행하기 위해서는 자바 가상 머신이 설치되어 있어야 한다.

### 자바 바이트 코드
- 자바 바이트 코드는 자바 가상 머신이 이해할 수 있는 언어로 변환된 자바 소스 코드이다.
- 자바 바이트 코트의 확장자는 .class이다.
- 자바 바이트 코드는 자바 가상 머신만 설치되어 있으면, 어떤 운영체제에서라도 실행될 수 있다.

### 자바 컴파일러
- 자바 컴파일러는 자바를 가지고 작성한 자바 소스 코드를 자바 가상 머신이 이해할 수 있는 자바 바이트 코드로 변환한다.
- 자바 컴파일러는 자바를 설치하면 javac.exe라는 실행 파일 형태로 설치된다.

# 컴파일 하는 방법
- 자바에서 컴파일이란 JVM을 대상으로 하는 컴파일이다. 
- 이때 나오는 코드는 .class 파일로 바이트코드라고 한다.
```
$ javac main.java
```

- 컴파일 된 자바 바이트 코드 파일은 클래스 로더에 의해 메모리에 로드 된다.

# 실행 하는 방법
- JVM은 자바 바이트 코드를 실행하는데, 일반적으로는 인터프리터 방식으로 동작한다.
- 인터프리터 방식은 바이트 코드를 한 줄씩 읽어들이면서 실랭하는 방식으로, 실행 속도가 느리다는 단점이 있다.
- 이를 해결하기 위해 Just-In-Time 컴파일러 (JIT compiler)를 도입하여 이러한 속도 저하를 보완했다.
- 위 과정(JIT-Compliter)을 통해 바이트 코드가 기계어 코드로 변환이 되고, JVM에서 실행된다.

# JIT 컴파일러란 무엇이며 어떻게 동작하는지
- Just-In-Time 컴파일러는 인터프리터 방식으로 바이트 코드를 실행할 때, 실행 속도가 느린 부분을 파악하여 해당 부분을 네이티브 코드로 변환하고, 이후에는 인터프리터 대신에 네이티브 코드를 직접 실행하는 방식으로 동작한다.

- JIT 컴파일러가 컴파일하는 과정은 바이트코드를 하나씩 인터프리팅하는 것보다 훨씬 오래걸리기에 만약, 한번만 실행되는 코드라면 컴파일 하지 않고, 인터프리팅 하는게 유리하다. 따라서 컴파일러를 사용하는 JVM들은 내부에서 해당 메소드의 수행빈도를 확인 후 일정 정도를 넘을 때 컴파일을 수행한다.

# JVM 구성요소
자바 가상 머신 (JVM)은 다음과 같이 구성된다.

클래스 로더가 컴파일된 자바 바이트 코드를 메모리영역에 로드하고, 실행엔진이 자바 바이트코드를 실행한다.

- 클래스 로더
  - 로딩
    - 클래스 로더가 .class 파일을 읽고 그 내용에 따라 적절한 바이너리 데이터를 만들어 메소드 영역에 저장
    이 때 메소드 영역에 저장하는 데이터는
      - FQCN(Fully Quallified Class Name)
      - 클래스 | 인터페이스 | Enum
      - 메소드와 변수
    - 로딩이 끝나면 해당 클래스 타입의 Class 객체를 생성하여 heap 영역에 저장
  - 링크
    - 클래스나 인터페이스의 레퍼런스를 해결하고, 필드와 메소드를 준비하는 과정
  - 초기화
    - static 값들을 초기화 및 변수에 할당하는 과정이다.
- 메모리
  - 스택
    - 자바 프로그램에서 메소드가 호출될 때 메소드의 스택 프레임이 저장되는 영역
    - JVM은 자바 프로그램에서 메소드가 호출되면, 메소드의 호출과 관계되는 지역 변수와 매개변수를 스택영역에 저장
    - 스택 영역은 메소드의 호출과 함께 할당되며, 메소드의 호출이 완료되면 소멸
  - PC
    - 쓰레드가 생성될 때마다 생성되는 영역으로 현재 쓰레드가 실행되는 부분의 주소와 명령을 저장하고 있는 영역
  - 네이티브 메소드 스택
    - 자바 외 언어로 작성된 네이티브 코드를 위한 메모리 영역
  - 힙
    - 자바 프로그램에서 사용되는 모든 인스턴스 변수가 저장되는 영역
    - 자바 프로그램에서 new 키워드를 사용하여 인스턴스가 생성되면, 해당 인스턴스 정보를 힙 영역에 저장
  - 메소드
    - 자바 프로그램에서 사용되는 클래스에 대한 정보와 함께 클래스 변수(static variable)가 저장되는 영역
    - 자바 프로그램에서 특정 클래스가 사용되면 해당 클래스의 클래스 파일(*.class)를 읽어들여, 해당 클래스에 대한 정보를 메소드 영역에 저장
- 실행엔진
  - 자바 인터프리터
  -  JIT 컴파일러
  -  가비지 컬렉터

# JDK와 JRE의 차이

### JDK
- JDK는 자바 언어를 사용하여 프로그램을 개발하기 위한 도구 모음
- JDK는 JRE와 JVM을 포함하며 컴파일러(javac), 디버거, 자바 라이브러리, 문서 생성 도구 (javadoc)등을 포함

### JRE
- 자바 프로그램을 실행하기 위한 환경을 제공
- JRE는 JVM과 자바 클래스 라이브러리로 구성되어 있으며, 사용자는 JRE를 통해 자바 애플리케이션을 실행할 수 있다.
